#!/usr/bin/awk -f
#------------------------------------------------------------------------------#
#                            Programmed By Liz                                 #
#------------------------------------------------------------------------------#
# GPX pre process
# converts one long GPX
# flg=0  into lines
# flg!=0 formats lines
#
# 2024-03-31 cleand up indent logic
#===============================================================================
BEGIN {
   i=-2                                   # indent start level
   f=1                                    # indent flag
}
#===============================================================================
{
   if(flg)                                # format lines
   {
      switch($0)
      {
         case /^<\// :                    # - indent
            i--
            f=0                           # cancel indent
            break
         case /^</ :                      # + indent
            if(f==1)
            {
               i++
            }
            if($0 ~ /<\//)                # cancel indent
               f=0
            else
               f=1
            break
      }
      for(j=0;j<i;j++)
         printf("   ")
      printf("%s\n",$0)
   }
   else                                   # break lines
   {
      gsub(/></,">\n<")
      print
   }
}
#===============================================================================
END {
}
#===============================================================================
# functions
#-------------------------------------------------------------------------------
#===============================================================================
